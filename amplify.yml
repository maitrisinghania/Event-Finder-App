version: 1
backend:
  phases:
    preBuild:
      commands:
        # Build frontend first
        - ls -la  # Debug: List files to verify structure
        - cd client
        - npm ci
        - npm run build
        - mkdir -p ../server/build
        - cp -r build/* ../server/build/
        # Then setup backend
        - cd ../server
        - npm ci
    build:
      commands:
        - echo "Backend build phase"
    start:
      commands:
        - node server.js
  artifacts:
    baseDirectory: server
    files:
      - '**/*'
  cache:
    paths:
      - client/node_modules/**/*
      - server/node_modules/**/*
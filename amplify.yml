version: 1
frontend:
  phases:
    preBuild:
      commands:
        - cd client  # Navigate to the React app directory
        - npm ci  # Install dependencies
    build:
      commands:
        - npm run build  # Build the React app
        - mkdir -p ../server/build  # Ensure backend build directory exists
        - cp -r build/* ../server/build/  # Copy build files to backend build folder
  artifacts:
    baseDirectory: server/build  # Define where the `index.html` is located
    files:
      - '**/*'
  cache:
    paths:
      - client/node_modules/**/*  # Cache frontend dependencies
backend:
  phases:
    preBuild:
      commands:
        - cd server  # Navigate to the backend directory
        - npm ci  # Install backend dependencies
    build:
      commands: []
  start:
    commands:
      - node server.js  # Start the backend server

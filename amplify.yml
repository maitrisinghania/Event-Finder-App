version: 1
frontend:
  phases:
    preBuild:
      commands:
        - pwd  # Debug: Check current directory
        - ls -la  # Debug: List files in the current directory
        - cd /codebuild/output/src*/src/Event-Finder-App  # Navigate to project root
        - ls -la  # Debug: Verify directory contents
        - cd client  # Navigate to frontend directory
        - npm ci  # Install frontend dependencies
    build:
      commands:
        - npm run build  # Build the frontend
        - mkdir -p ../server/build  # Create the build folder in the backend
        - cp -r build/* ../server/build/  # Copy the built files to the backend folder
  artifacts:
    baseDirectory: server  # Set the backend folder as the base directory
    files:
      - '**/*'  # Include all files
  cache:
    paths:
      - client/node_modules/**/*  # Cache frontend dependencies
backend:
  phases:
    build:
      commands:
        - cd /codebuild/output/src*/src/Event-Finder-App  # Navigate to project root
        - cd server  # Navigate to backend directory
        - npm ci  # Install backend dependencies
phases:
  start:
    command: "node server/server.js"  # Start the backend server
